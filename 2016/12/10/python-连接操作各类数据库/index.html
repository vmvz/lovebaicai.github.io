<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> python 连接操作各类数据库 · iLovebaicai</title><meta name="description" content="python 连接操作各类数据库 - Nemo Chen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://messay.me/atom.xml" title="iLovebaicai"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/cfqtxd1" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/lovebaicai" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://messay.me/about/" target="_blank" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">python 连接操作各类数据库</h1><div class="post-info">2016年12月10日</div><div class="post-content"><h4 id="python-连接操作各类数据库"><a href="#python-连接操作各类数据库" class="headerlink" title="python 连接操作各类数据库"></a>python 连接操作各类数据库</h4><h4 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h4><ul>
<li>用Python写脚本也有一段时间了，经常操作数据库（MySQL），现在就整理下对各类数据库的操作，如后面有新的参数会补进来，慢慢完善。</li>
</ul>
<a id="more"></a>
<h4 id="一，python-操作-MySQL-详情见：这里"><a href="#一，python-操作-MySQL-详情见：这里" class="headerlink" title="一，python 操作 MySQL:详情见：这里"></a>一，python 操作 MySQL:详情见：<a href="http://mysql-python.sourceforge.net/MySQLdb.html" target="_blank" rel="external">这里</a></h4><ul>
<li>mac 安装：<ul>
<li><a href="http://sourceforge.net/projects/mysql-python/?source=dlp" target="_blank" rel="external">http://sourceforge.net/projects/mysql-python/?source=dlp</a></li>
<li>sudo python setup.py build</li>
</ul>
</li>
<li>ubuntu安装:<ul>
<li>apt-get install python-mysqldb</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/bin/env python</span></div><div class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></div><div class="line"><span class="comment">#-------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"># Purpose:     example for python_to_mysql</span></div><div class="line"><span class="comment"># Author:      zhoujy</span></div><div class="line"><span class="comment"># Created:     2013-06-14</span></div><div class="line"><span class="comment"># update:      2013-06-14</span></div><div class="line"><span class="comment">#-------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">import</span> MySQLdb</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="comment">#建立和数据库系统的连接，格式</span></div><div class="line"><span class="comment">#conn   = MySQLdb.connect(host='localhost',user='root',passwd='123456',db='test',port=3306,charset='utf8')</span></div><div class="line"></div><div class="line"><span class="comment">#指定配置文件，确定目录,或则写绝对路径</span></div><div class="line">cwd = os.path.realpath(os.path.dirname(__file__))</div><div class="line">db_conf = os.path.join(cwd, <span class="string">'db.conf'</span>)</div><div class="line">conn   = MySQLdb.connect(read_default_file=db_conf,host=<span class="string">'localhost'</span>,db=<span class="string">'test'</span>,port=<span class="number">3306</span>,charset=<span class="string">'utf8'</span>)</div><div class="line"></div><div class="line"><span class="comment">#要执行的sql语句</span></div><div class="line">query  = <span class="string">'select id  from t1'</span></div><div class="line"></div><div class="line"><span class="comment">#获取操作游标</span></div><div class="line">cursor = conn.cursor()</div><div class="line"></div><div class="line"><span class="comment">#执行SQL</span></div><div class="line">cursor.execute(query)</div><div class="line"></div><div class="line"><span class="comment">#获取一条记录,每条记录做为一个元组返回,返回3，游标指到第2条记录。</span></div><div class="line">result1 = cursor.fetchone()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result1:</div><div class="line">    <span class="keyword">print</span> i</div><div class="line"><span class="comment">#返回影响的行数</span></div><div class="line">    <span class="keyword">print</span> cursor.rowcount</div><div class="line"></div><div class="line"><span class="comment">#获取指定数量记录,每条记录做为一个元组返回,返回1，2，游标从第2条记录开始，游标指到第4条记录。</span></div><div class="line">result2 = cursor.fetchmany(<span class="number">2</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result2:</div><div class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> i:</div><div class="line">        <span class="keyword">print</span> ii</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#获取所有记录,每条记录做为一个元组返回,返回3，4，7，6,游标从第4条记录开始到最后。</span></div><div class="line">result3 = cursor.fetchall()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result3:</div><div class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> i:</div><div class="line">        <span class="keyword">print</span> ii</div><div class="line"></div><div class="line"><span class="comment">#获取所有记录,每条记录做为一个元组返回,返回3，4，7，6,游标从第1条记录开始</span></div><div class="line"><span class="comment">#重置游标位置，0为偏移量，mode＝absolute | relative,默认为relative</span></div><div class="line">cursor.scroll(<span class="number">0</span>,mode=<span class="string">'absolute'</span>)</div><div class="line">result3 = cursor.fetchall()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result3:</div><div class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> i:</div><div class="line">        <span class="keyword">print</span> ii</div><div class="line"></div><div class="line"><span class="comment">#以下2种方法都可以把数据插入数据库：</span></div><div class="line"><span class="comment">#(one)</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range (<span class="number">10</span>,<span class="number">20</span>):</div><div class="line">    query2 = <span class="string">'insert into t1 values("%d",now())'</span> %i</div><div class="line">    cursor.execute(query2)</div><div class="line">    <span class="comment">#提交</span></div><div class="line">    conn.rollback()</div><div class="line"><span class="comment">#(two)</span></div><div class="line">rows = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range (<span class="number">10</span>,<span class="number">20</span>):</div><div class="line">    rows.append(i)</div><div class="line">query2 = <span class="string">'insert into t1 values("%s",now())'</span></div><div class="line"><span class="comment">#executemany 2个参数,第2个参数是变量。</span></div><div class="line">cursor.executemany(query2,rows)</div><div class="line"><span class="comment">#提交</span></div><div class="line">conn.commit()</div><div class="line"></div><div class="line"><span class="comment">#选择数据库</span></div><div class="line">query3 = <span class="string">'select id from dba_hospital'</span></div><div class="line"><span class="comment">#重新选择数据库</span></div><div class="line">conn.select_db(<span class="string">'chushihua'</span>)</div><div class="line"></div><div class="line">cursor.execute(query3)</div><div class="line"></div><div class="line">result4 = cursor.fetchall()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result4:</div><div class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> i:</div><div class="line">        <span class="keyword">print</span> ii</div><div class="line"><span class="comment">#不定义query，直接执行：</span></div><div class="line">cursor.execute(<span class="string">"set session binlog_format='mixed'"</span>)</div><div class="line"></div><div class="line"><span class="comment">#关闭游标，释放资源</span></div><div class="line">cursor.close()</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">+------+---------------------+</div><div class="line">| id   | modifyT             |</div><div class="line">+------+---------------------+</div><div class="line">|    3 | 2010-01-01 00:00:00 |</div><div class="line">|    1 | 2010-01-01 00:00:00 |</div><div class="line">|    2 | 2010-01-01 00:00:00 |</div><div class="line">|    3 | 2010-01-01 00:00:00 |</div><div class="line">|    4 | 2013-06-04 17:04:54 |</div><div class="line">|    7 | 2013-06-04 17:05:36 |</div><div class="line">|    6 | 2013-06-04 17:05:17 |</div><div class="line">+------+---------------------+</div></pre></td></tr></table></figure>
<h4 id="注意：在脚本中，密码写在脚本里面很容易暴露，这样可以用一个配置文件的方式来存密码，如db-conf："><a href="#注意：在脚本中，密码写在脚本里面很容易暴露，这样可以用一个配置文件的方式来存密码，如db-conf：" class="headerlink" title="注意：在脚本中，密码写在脚本里面很容易暴露，这样可以用一个配置文件的方式来存密码，如db.conf："></a>注意：在脚本中，密码写在脚本里面很容易暴露，这样可以用一个配置文件的方式来存密码，如db.conf：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">user=root</div><div class="line">password=<span class="number">123456</span></div></pre></td></tr></table></figure>
<hr>
<h4 id="二，-python-操作-MongoDB-详情见这里"><a href="#二，-python-操作-MongoDB-详情见这里" class="headerlink" title="二， python 操作 MongoDB:详情见这里"></a>二， python 操作 MongoDB:详情见<a href="http://api.mongodb.org/python/current/api/index.html" target="_blank" rel="external">这里</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/bin/env python</span></div><div class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></div><div class="line"><span class="comment">#-------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"># Purpose:     example for python_to_mongodb</span></div><div class="line"><span class="comment"># Author:      zhoujy</span></div><div class="line"><span class="comment"># Created:     2013-06-14</span></div><div class="line"><span class="comment"># update:      2013-06-14</span></div><div class="line"><span class="comment">#-------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">import</span> pymongo</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="comment">#建立和数据库系统的连接,创建Connection时，指定host及port参数</span></div><div class="line">conn   = pymongo.Connection(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">27017</span>)</div><div class="line"></div><div class="line"><span class="comment">#admin 数据库有帐号，连接-认证-切换库</span></div><div class="line">db_auth = conn.admin</div><div class="line">db_auth.authenticate(<span class="string">'sa'</span>,<span class="string">'sa'</span>)</div><div class="line"><span class="comment">#连接数据库</span></div><div class="line">db = conn.abc</div><div class="line"></div><div class="line"><span class="comment">#连接表</span></div><div class="line">collection = db.stu</div><div class="line"></div><div class="line"><span class="comment">#查看全部表名称</span></div><div class="line">db.collection_names()</div><div class="line"><span class="comment">#print db.collection_names()</span></div><div class="line"></div><div class="line"><span class="comment">#访问表的数据，指定列</span></div><div class="line">item = collection.find(&#123;&#125;,&#123;<span class="string">"sname"</span>:<span class="number">1</span>,<span class="string">"course"</span>:<span class="number">1</span>,<span class="string">"_id"</span>:<span class="number">0</span>&#125;)</div><div class="line"><span class="keyword">for</span> rows <span class="keyword">in</span> item:</div><div class="line">    <span class="keyword">print</span> rows.values()</div><div class="line"></div><div class="line"><span class="comment">#访问表的一行数据</span></div><div class="line"><span class="keyword">print</span> collection.find_one()</div><div class="line"></div><div class="line"><span class="comment">#得到所有的列</span></div><div class="line"><span class="keyword">for</span> rows <span class="keyword">in</span> collection.find_one():</div><div class="line">    <span class="keyword">print</span> rows</div><div class="line"></div><div class="line"><span class="comment">#插入</span></div><div class="line">collection.insert(&#123;<span class="string">"sno"</span>:<span class="number">100</span>,<span class="string">"sname"</span>:<span class="string">"jl"</span>,<span class="string">"course"</span>:&#123;<span class="string">"D"</span>:<span class="number">80</span>,<span class="string">"S"</span>:<span class="number">85</span>&#125;&#125;)</div><div class="line"><span class="comment">#或</span></div><div class="line">u = dict(sno=<span class="number">102</span>,sname=<span class="string">'zjjj'</span>,course=&#123;<span class="string">"D"</span>:<span class="number">80</span>,<span class="string">"S"</span>:<span class="number">85</span>&#125;)</div><div class="line">collection.insert(u)</div><div class="line"></div><div class="line"><span class="comment">#得到行数</span></div><div class="line"><span class="keyword">print</span> collection.find().count()</div><div class="line"><span class="keyword">print</span> collection.find(&#123;<span class="string">"sno"</span>:<span class="number">100</span>&#125;)</div><div class="line"></div><div class="line"><span class="comment">#排序，按照某一列的值。pymongo.DESCENDING:倒序；pymongo.ASCENDING:升序。按照sno倒序</span></div><div class="line">item = collection.find().sort(<span class="string">'sno'</span>,pymongo.DESCENDING)</div><div class="line"><span class="keyword">for</span> rows <span class="keyword">in</span> item:</div><div class="line">    <span class="keyword">print</span> rows.values()</div><div class="line"></div><div class="line"><span class="comment">#多列排序</span></div><div class="line">item = collection.find().sort([(<span class="string">'sno'</span>,pymongo.DESCENDING),(<span class="string">'A'</span>,pymongo.ASCENDING)])</div><div class="line"></div><div class="line"><span class="comment">#更新，第一个参数是条件，第二个参数是更新操作，$set,%inc,$push,$ne,$addToSet,$rename 等</span></div><div class="line">collection.update(&#123;<span class="string">"sno"</span>:<span class="number">100</span>&#125;,&#123;<span class="string">"$set"</span>:&#123;<span class="string">"sno"</span>:<span class="number">101</span>&#125;&#125;)</div><div class="line"><span class="comment">#更新多行和多列</span></div><div class="line">collection.update(&#123;<span class="string">"sno"</span>:<span class="number">102</span>&#125;,&#123;<span class="string">"$set"</span>:&#123;<span class="string">"sno"</span>:<span class="number">105</span>,<span class="string">"sname"</span>:<span class="string">"SSSS"</span>&#125;&#125;,multi=<span class="keyword">True</span>)</div><div class="line"></div><div class="line"><span class="comment">#删除，第一个参数是条件，第二个参数是删除操作。</span></div><div class="line">collection.remove(&#123;<span class="string">"sno"</span>:<span class="number">101</span>&#125;)</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">sno:学号；sname：姓名；course：科目</div><div class="line"></div><div class="line">db.stu.insert(&#123;"sno":1,"sname":"张三","course":&#123;"A":95,"B":90,"C":65,"D":74,"E":100&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":2,"sname":"李四","course":&#123;"A":90,"B":85,"X":75,"Y":64,"Z":95&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":3,"sname":"赵五","course":&#123;"A":70,"B":56,"F":85,"G":84,"H":80&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":4,"sname":"zhoujy","course":&#123;"A":64,"B":60,"C":95,"T":94,"Y":85&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":5,"sname":"abc","course":&#123;"A":87,"B":70,"Z":56,"G":54,"H":75&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":6,"sname":"杨六","course":&#123;"A":65,"U":80,"C":78,"R":75,"N":90&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":7,"sname":"陈二","course":&#123;"A":95,"M":68,"N":84,"S":79,"K":89&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":8,"sname":"zhoujj","course":&#123;"P":90,"B":77,"J":85,"K":68,"L":80&#125;&#125;)</div><div class="line">db.stu.insert(&#123;"sno":9,"sname":"ccc","course":&#123;"Q":85,"B":86,"C":90,"V":87,"U":85&#125;&#125;)</div><div class="line"></div><div class="line">'''</div><div class="line"></div><div class="line">计算Mongodb文档中各集合的数目：</div><div class="line"></div><div class="line"><span class="keyword">import</span> pymongo</div><div class="line"></div><div class="line">conn   = pymongo.Connection(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">27017</span>)</div><div class="line">db = conn.abc    <span class="comment">#abc文档</span></div><div class="line"><span class="keyword">for</span> tb_name <span class="keyword">in</span> db.collection_names():     <span class="comment">#循环出各集合名</span></div><div class="line">    Count = db[tb_name].count()            <span class="comment">#计算各集合的数量</span></div><div class="line">    <span class="keyword">if</span> Count &gt; <span class="number">2</span>:                                 <span class="comment">#过滤条件</span></div><div class="line">        <span class="keyword">print</span> tb_name + <span class="string">':'</span> + str(Count)</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">conn   = pymongo.Connection(host='127.0.0.1',port=27017)</div><div class="line">db = conn.abc</div><div class="line">for tb_name in db.collection_names():</div><div class="line">    print tb_name + ':'</div><div class="line">    exec('print ' + 'db.'+tb_name+'.count()')      #变量当集合的处理方式</div><div class="line"></div><div class="line">OR</div><div class="line"></div><div class="line">conn   = pymongo.Connection(host='127.0.0.1',port=27017)</div><div class="line">db = conn.abc</div><div class="line">for tb_name in db.collection_names():</div><div class="line">    mon_dic=db.command("collStats", tb_name)      #以字典形式返回</div><div class="line">    print mon_dic.get('ns'),mon_dic.get('count')</div><div class="line"></div><div class="line">'''</div></pre></td></tr></table></figure>
<h4 id="Note-MongoDB升级到了3-0之后，用python的连接会出错："><a href="#Note-MongoDB升级到了3-0之后，用python的连接会出错：" class="headerlink" title="Note: MongoDB升级到了3.0之后，用python的连接会出错："></a>Note: MongoDB升级到了3.0之后，用python的连接会出错：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pymongo.errors.OperationFailure: command SON([(<span class="string">'authenticate'</span>, <span class="number">1</span>), (<span class="string">'user'</span>, <span class="string">u'dba'</span>), (<span class="string">'nonce'</span>, <span class="string">u'8c7842b068e14d3'</span>), (<span class="string">'key'</span>, <span class="string">u'584ec63f1cdfd8525ce33d99cd269c2c'</span>)]) failed: auth failed</div><div class="line">表示认证失败，说明MongoDB升级之后，对用用户的加密方式改变了。那就升级pymongo。</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">$ sudo pip install pymongo --upgrade</div><div class="line">升级成功，要是没有安装pip，看这里：http://www.saltycrane.com/blog/<span class="number">2010</span>/<span class="number">02</span>/how-install-pip-ubuntu/</div><div class="line"></div><div class="line">ubuntu10<span class="number">.10</span>之后：</div><div class="line"></div><div class="line">$ sudo apt-get install python-pip python-dev build-essential</div><div class="line">$ sudo pip install --upgrade pip</div><div class="line">$ sudo pip install --upgrade virtualenv</div><div class="line">ubuntu10<span class="number">.10</span>之前的老版本：</div><div class="line"></div><div class="line">$ sudo apt-get install python-setuptools python-dev build-essential</div><div class="line"></div><div class="line">$ sudo easy_install pip</div><div class="line"></div><div class="line">$ sudo pip install --upgrade virtualenv</div><div class="line">升级成功之后，继续执行python脚本，还是出错：</div><div class="line"></div><div class="line">AttributeError: <span class="string">'module'</span> object has no attribute <span class="string">'Connection'</span></div><div class="line">表示没有 Connection ，pymongo升级完之后不支持了，看手册，发现用MongoClient 来替换了Connection。修改脚本：</div><div class="line"></div><div class="line">conn   = pymongo.Connection(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">27017</span>)</div><div class="line">改成</div><div class="line">conn   = pymongo.MongoClient(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">27017</span>)</div><div class="line"> 最后执行python，正常。</div></pre></td></tr></table></figure>
<hr>
<h4 id="三，python-操作-Redis-详情见这里"><a href="#三，python-操作-Redis-详情见这里" class="headerlink" title="三，python 操作 Redis:详情见这里"></a>三，python 操作 Redis:详情见<a href="https://redis.readthedocs.org/en/latest/" target="_blank" rel="external">这里</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/bin/env python</span></div><div class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></div><div class="line"><span class="comment">#-------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"># Purpose:     example for python_to_mongodb</span></div><div class="line"><span class="comment"># Author:      zhoujy</span></div><div class="line"><span class="comment"># Created:     2013-06-14</span></div><div class="line"><span class="comment"># update:      2013-06-14</span></div><div class="line"><span class="comment">#-------------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"></div><div class="line">f = open(<span class="string">'aa.txt'</span>)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    line = f.readline().strip().split(<span class="string">' # '</span>)</div><div class="line">    <span class="keyword">if</span> line == [<span class="string">''</span>]:</div><div class="line">        <span class="keyword">break</span></div><div class="line">    UserName,Pwd,Email = line</div><div class="line"><span class="comment">#    print name.strip(),pwd.strip(),email.strip()</span></div><div class="line">    rc = redis.StrictRedis(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">6379</span>,db=<span class="number">15</span>)</div><div class="line">    rc.hset(<span class="string">'Name:'</span> + UserName,<span class="string">'Email'</span>,Email)</div><div class="line">    rc.hset(<span class="string">'Name:'</span> + UserName,<span class="string">'Password'</span>,Pwd)</div><div class="line">f.close()</div><div class="line"></div><div class="line">alluser = rc.keys(<span class="string">'*'</span>)</div><div class="line"><span class="comment">#print alluser</span></div><div class="line"><span class="keyword">print</span> <span class="string">"===================================读出存进去的数据==================================="</span></div><div class="line"><span class="keyword">for</span> user <span class="keyword">in</span> alluser:</div><div class="line">    <span class="keyword">print</span> <span class="string">' # '</span>.join((user.split(<span class="string">':'</span>)[<span class="number">1</span>],rc.hget(user,<span class="string">'Password'</span>),rc.hget(user,<span class="string">'Email'</span>)))</div></pre></td></tr></table></figure>
<hr>
<h4 id="四，python-操作-memcache-详情见这里"><a href="#四，python-操作-memcache-详情见这里" class="headerlink" title="四，python 操作 memcache:详情见这里"></a>四，python 操作 memcache:详情见<a href="http://www.cnblogs.com/zhoujinyi/archive/2013/04/22/3033230.html" target="_blank" rel="external">这里</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> memcache</div><div class="line">mc = memcache.Client([<span class="string">'127.0.0.1:11211'</span>],debug=<span class="number">1</span>)</div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"><span class="keyword">import</span> MySQLdb</div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">(mysql_conn)</span>:</span></div><div class="line"><span class="comment">#    nn = raw_input("press string name:")</span></div><div class="line">    mc = memcache.Client([<span class="string">'127.0.0.1:11211'</span>],debug=<span class="number">1</span>)</div><div class="line">    t1 =time.time()</div><div class="line">    value = mc.get(<span class="string">'zhoujinyia'</span>)</div><div class="line">    <span class="keyword">if</span> value == <span class="keyword">None</span>:</div><div class="line">        t1 = time.time()</div><div class="line">        <span class="keyword">print</span> t1</div><div class="line">        query = <span class="string">"select company,email,sex,address from uc_user_offline where realName = 'zhoujinyia'"</span></div><div class="line">        cursor= mysql_conn.cursor()</div><div class="line">        cursor.execute(query)</div><div class="line">        item = cursor.fetchone()</div><div class="line">        t2 = time.time()</div><div class="line">        <span class="keyword">print</span> t2</div><div class="line">        t = round(t2-t1)</div><div class="line">        <span class="keyword">print</span> <span class="string">"from mysql cost %s sec"</span> %t</div><div class="line">        <span class="keyword">print</span> item</div><div class="line">        mc.set(<span class="string">'zhoujinyia'</span>,item,<span class="number">60</span>)</div><div class="line">    <span class="keyword">else</span> :</div><div class="line">        t2 = time.time()</div><div class="line">        t=round(t2-t1)</div><div class="line">        <span class="keyword">print</span> <span class="string">"from memcache cost %s sec"</span> %t</div><div class="line">        <span class="keyword">print</span> value</div><div class="line"><span class="keyword">if</span> __name__ ==<span class="string">'__main__'</span>:</div><div class="line">    mysql_conn = MySQLdb.connect(host=<span class="string">'127.0.0.1'</span>,user=<span class="string">'root'</span>,passwd=<span class="string">'123456'</span>,db=<span class="string">'member'</span>,port=<span class="number">3306</span>,charset=<span class="string">'utf8'</span>)</div><div class="line">    get_data(mysql_conn)</div></pre></td></tr></table></figure>
<hr>
<h4 id="Note-上面介绍了一些python连接数据库，大部分的操作没有列出来，具体的请见各官网。"><a href="#Note-上面介绍了一些python连接数据库，大部分的操作没有列出来，具体的请见各官网。" class="headerlink" title="Note: 上面介绍了一些python连接数据库，大部分的操作没有列出来，具体的请见各官网。"></a>Note: 上面介绍了一些python连接数据库，大部分的操作没有列出来，具体的请见各官网。</h4></div></article></div></main><footer><div class="paginator"><a href="/2016/12/10/python中date、datetime、string的相互转换/" class="prev">PREV</a><a href="/2016/11/09/vim-zsh使用tab报错/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://messay.me">Nemo Chen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-91949407-1",'auto');ga('send','pageview');</script></body></html>